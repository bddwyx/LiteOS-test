# LiteOS-test
OpenHarmony LiteOS test on TI‘s TM4C129

TM4C129鸿蒙LiteOS测试

本仓库为上海交通大学工科创2A大作业，项目名称为基于LiteOS的多功能电子时钟开发

# Notice
* The Project is partially based on CMSIS. However, due to unknown reasons, #include <core_cm4.h> may cause trouble.
* startup.s and scatter file(.sct) have been changed. (LOS_HEAP) 
* The repository is under MIT License.

# 功能描述

## 常规功能

​	多功能时钟共有四种模式，分别为显示模式、设置模式、闹钟模式和秒表模式。

* 显示模式提供了24小时时钟显示、年月日显示与节气显示的功能。通过按下显示切换按键可以对显示的内容进行更改。
* 设置模式可以对时间、日期与指针位置进行修改。进入设置模式后，按照提示可以依次进行小时、分钟、秒、年、月、日、指针设置。在设置模式中，可以通过取消按键退回至显示模式。这种情况下，所有在退出前进行的操作是全部有效的。
* 闹钟模式可以对闹钟的时间与开关进行修改。进入闹钟模式后，按照提示可以选定相应序号的闹钟，并设置小时与分钟数值。在这步操作后，会进入闹钟开关设置，此步骤可以选择是否使能闹钟。闹钟使能后会在每天相应时刻响铃，任意按键或编码器可以关闭闹钟。在闹钟模式中，可以通过取消按键退回至显示模式。这种情况下，所有在退出前进行的操作是全部有效的。
* 秒表模式提供一个分度值为0.01s的倒计时秒表，通过按键可以设置秒表的计时时间。在检测到确认按键后，秒表计时开始，此时可通过秒表按键暂停计时。当秒表计数值为0时，秒表停止计时，并将触发音乐播放。在计时过程中对计数值的设置将导致秒表暂停。在秒表模式中，可以通过取消按键退回至显示模式。

## 指示灯

​	8位LED会对当前的状态进行显示。其中前两位指示显示模式所处的页面编号，第3位和第4位代表设置模式下当前设置的内容。第5位和第6位指示秒表目前的状态，第5位点亮代表秒表未开始计时，第6位点亮代表秒表正处于工作状态。第7位和第8位指示闹钟设置情况。

# 操作方法

## 按键操作

​	按键操作可以实现多功能时钟的全部功能。在按键操作模式下，通过按照一定的逻辑顺序按下扩展板上的8个按键，即可实现显示切换、时钟设置、日期设置、表盘设置、闹钟设置、秒表设置与计时等功能。按照空间位置，每个按键的功能如下表所示。

| 取消 | 闹钟 | 秒表 | 显示切换 |
| -------- | ------------- | ------ | ---- |
| 设置 | 上 | 下 | 确定 |



​	每个按键的详细功能与具体解释如下表所示

| 按键 | 功能描述 | 备注 |
| --- | --------|-----|
| 设置 | 在显示模式下，进入对时间、日期、表盘进行设置 | |
| 闹钟 | 在显示模式下，进入对闹钟的时间及开关进行设置 | |
| 秒表 | 在显示模式下，进入秒表模式，可以对秒表计时进行设置以及开启秒表 | |
| 显示切换 | 在显示模式下，在时间显示、日期显示、节气显示之间切换 | |
| 确认 | 确认当前设置并进入下一项设置 | |
| 取消 | 保存已设置的结果，返回显示模式 | |
| 上 | 执行加操作 | 开关设置时恒定为开 |
| 下 | 执行减操作 | 开关设置时恒定为关 |



​	在执行数字设置及开关设置时，正交编码器可以替代“上”按键与“下”按键完成大跨度的设置。正交编码器的操作方式如下表所示。

| 编码器方向 | 功能描述 |
| --- | --------|
| 顺时针 | 等同于“上”按键 |
| 逆时针 | 等同于“下”按键 |



## 串口操作

​	为方便调试工作，多功能时钟提供一些基本的串口指令。串口指令读取UART0接收到的数据，UART0配置为波特率115200，8位数据无校验。串口指令以回车换行（"\r\n"）结尾。串口指令及功能如下表所示。

| 串口指令 | 功能描述 | 返回内容 | 应用举例 |
| :-: | --------|-----| ------ |
| SET | 对时间进行设置 | 无 | SET12:00:00 设置时间为正午12时 |
| INC | 对时间进行增加操作 | 无 | INC00:00:01 时间增加1s |
| DATE | 对日期进行设置 | 设置是否成功 | DATE20210620 设置日期为2021年6月20日 |
| ALARM | 对指定序号的闹钟进行设置 | 设置是否成功 | ALARM51200 将闹钟5设置为12:00 |
| STOPWATCH | 对秒表计时时间进行设置 | 设置是否成功 | STOPWATCH55 设置秒表计时时间为55s |
| GETTIME | 获得当前时间 | TIME+当前时间 | GETTIME |
| GETDATE | 获得当前日期 | DATE+当前日期 | GETDATE |
| RESET | 软件重启 | 无 | RESET |

​	由于按键操作已实现全部功能，故串口操作仅提供部分关键功能的指令。如需更多指令，可在指令系统中方便快捷地添加更多的操作。

